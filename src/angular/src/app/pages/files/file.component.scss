@use '../../common/common' as *;

.file {
    padding: 10px;
}

/* selected file */
.file.selected {
    background-color: var(--ss-secondary);
}

/* content */
.content {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    padding: 8px 0;
}

.content div {
    /* break up long text */
    overflow-wrap: normal;
    hyphens: auto;
    word-break: break-all;
}

/* width */
.content .status   {width: 100px; min-width: 100px;}
.content .name     {flex-grow: 1; flex-basis: calc(100% - 100px);}
.content .speed    {width: 100px; min-width: 100px;}
/* .content .eta is hidden on mobile */
.content .size     {flex-grow: 1;}

/* content elements */
.content > div {
    padding: 4px 4px;
    text-align: center;
    vertical-align: top;
}
.content .name {text-align: left;}

/* Name */
.content .name {
    display: flex;
    flex-direction: row;

    img {
        height: 20px;
        margin-right: 8px;
        margin-top: 1px;
    }

    .text {
        display: flex;
        flex-direction: column;

        .details {
            display: flex;
            flex-direction: column;

            .details-text {
                color: var(--ss-text-muted);
                font-size: 80%;
                line-height: 120%;

                .tab {
                    margin-left: 20px;
                }
            }
        }
    }
}

/* Status */
.content .status {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 62px;
    max-height: 62px;

    img {
        height: 35px;
        width: 35px;
    }

    // Optical weighting
    img#downloading, img#downloaded {
        width: 45px;
    }
    img#default-remote {
        width: 45px;
        height: 45px;
    }
    img#stopped {
        width: 30px;
    }

    .text {
        margin-top: 3px;
        font-size: 70%;
    }
}

/* Speed */
.content .speed {
    font-size: 90%;
}

/* Progress bar */
.content .progress-bar {
    min-width: 2em;
}
.content .progress {
    margin-bottom: 5px;
    height: 20px;
}
.content .size_info {
    font-size: 80%;
}

/* Hide the outer eta */
.content .eta {display: none;}
.content .speed .speed-eta {font-size: 90%;}

/* actions */
.actions {
    width: 100%;
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
    flex-wrap: wrap;
    /* offsets the button's margin-bottom */
    margin-bottom: -10px;
}
.actions .button {
    @extend %button;

    /* bottom margin for when buttons get wrapped to multiple rows */
    margin-bottom: 10px;
    margin-right: 10px;
    width: 60px;
    min-width: 60px;
    height: 60px;

    &:last-child {
        margin-right: 0;
    }

    .text {
        height: 25px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

        span {
            font-size: 12px;
            text-align: center;
            line-height: 12px;
        }
    }

    img {
        width: 25px;
        height: 25px;
        filter: invert(1.0);
    }

    .loader {
        display: none;
        border: 5px solid var(--ss-loader-border);
        border-top: 5px solid var(--ss-secondary-dark);
        border-radius: 50%;
        width: 25px;
        height: 25px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    // Show loader icon when loading
    &.loading {
        opacity: 1.0;
        background-color: var(--ss-secondary-dark);
        border-color: var(--ss-secondary-darker);

        img {
            display: none;
        }
        .loader {
            display: block;
        }
    }
}

/* action toolbar show and hide */
.actions {
    display: none;
}
.file.selected .actions {
    display: flex;
}

/* Delete confirmation dialog */
.delete-confirmation {
    background-color: var(--ss-overlay);
    padding: 15px;
    margin-top: 10px;
    border-radius: 4px;

    .confirmation-content {
        background-color: var(--ss-confirmation-bg);
        padding: 20px;
        border-radius: 4px;

        .confirmation-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .confirmation-message {
            margin-bottom: 15px;
        }

        .confirmation-buttons {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            gap: 10px;
        }
    }
}


/* Medium and large screens */
@media only screen and (min-width: $medium-min-width) {
    /* enable row hover */
    .file:not(.selected):hover {
        background-color: var(--ss-secondary-light);
    }

    /* width */
    /* NOTE: make sure this is in-sync with "#file-list #header" */
    .content .status    {width: 100px; min-width: 100px;}
    .content .name      {flex-grow: 1;}
    .content .speed     {width: 100px; min-width: 100px;}
    .content .eta       {width: 100px; min-width: 100px;}
    .content .size      {width: 30%; min-width: 30%;}

    .content {
        /* single row */
        flex-wrap: nowrap;
        /* no top/bottom padding */
        padding: 0 0;
    }

    /* Re-order columns */
    .content .status {order: 2;}
    .content .name {order: 1;}
    .content .speed {order: 3;}
    .content .eta {order: 4;}
    .content .size {order: 5;}

    /* Hide the inner eta, show outer eta */
    .content .eta {display: inline;}
    .content .speed .speed-eta {display: none;}
}

// ── Dark mode refinements ──
@keyframes subtlePulse {
    0%   { opacity: 0.9; }
    50%  { opacity: 1; }
    100% { opacity: 0.9; }
}

:host-context([data-bs-theme="dark"]) {
    // Row hover with transition
    .file:not(.selected) {
        transition: background 120ms ease;
    }
    .file:not(.selected):hover {
        background-color: var(--ss-surface-hover, #252C37);
    }

    // Selected file - muted for dark
    .file.selected {
        background-color: #252C37;
    }

    // ── Typography hierarchy ──
    .content .name .text .title {
        color: #E6EAF2;
    }

    .content .eta {
        color: #C7CEDB;
        font-weight: 500;
    }

    .content .speed {
        color: #8A93A6;
    }

    .content .size_info {
        color: #6B7280;
    }

    .content .status .text {
        color: #8A93A6;
    }

    // ── File type icons ──
    .content .name > img {
        filter: brightness(0) saturate(100%) invert(85%) sepia(5%) saturate(400%) hue-rotate(190deg);
    }

    // ── Progress bar redesign ──
    .content .progress {
        background-color: #2A3140;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.6);
    }

    .content .progress-bar {
        background-color: #4C8DFF;
        border-radius: 6px;
        // Remove Bootstrap stripe/animation in dark mode
        background-image: none;
        animation: none;

        // Subtle pulse for active downloads
        &.progress-bar-animated {
            background-image: none;
            animation: subtlePulse 2.4s infinite;
        }
    }

    // ── Status icon semantic tinting ──
    .content .status {
        img#downloading {
            filter: brightness(0) saturate(100%) invert(52%) sepia(88%) saturate(1200%) hue-rotate(203deg) brightness(102%) contrast(101%);
        }
        img#downloaded {
            filter: brightness(0) saturate(100%) invert(72%) sepia(30%) saturate(800%) hue-rotate(105deg) brightness(95%) contrast(90%);
        }
        img#queued {
            filter: brightness(0) saturate(100%) invert(70%) sepia(60%) saturate(600%) hue-rotate(5deg) brightness(100%) contrast(95%);
        }
        img#extracted {
            filter: brightness(0) saturate(100%) invert(72%) sepia(30%) saturate(800%) hue-rotate(105deg) brightness(95%) contrast(90%);
        }
        img#stopped {
            filter: brightness(0) saturate(100%) invert(85%) sepia(5%) saturate(400%) hue-rotate(190deg);
        }
        img#default-remote {
            filter: brightness(0) saturate(100%) invert(60%) sepia(5%) saturate(300%) hue-rotate(190deg);
        }
        img#deleted {
            filter: brightness(0) saturate(100%) invert(50%) sepia(40%) saturate(800%) hue-rotate(320deg) brightness(100%) contrast(95%);
        }
        img#extracting {
            filter: brightness(0) saturate(100%) invert(52%) sepia(88%) saturate(1200%) hue-rotate(203deg) brightness(102%) contrast(101%);
        }
        img#extract-failed {
            filter: brightness(0) saturate(100%) invert(30%) sepia(95%) saturate(6000%) hue-rotate(355deg) brightness(95%) contrast(110%);
        }
    }

    // ── Dim 0% progress rows ──
    .file:has(.progress-bar[aria-valuenow="0"]) {
        opacity: 0.85;
    }

    // ── Action buttons ──
    .actions .button {
        background-color: #1D222B;
        border-color: #252C37;

        &:active {
            background-color: #252C37;
        }

        img {
            filter: brightness(0) saturate(100%) invert(85%) sepia(5%) saturate(400%) hue-rotate(190deg);
        }
    }

    // ── Delete confirmation ──
    .delete-confirmation .confirmation-content {
        border: 1px solid #252C37;
    }
}
